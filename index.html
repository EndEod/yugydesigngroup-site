<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ìš©ë„ë³„ ì¸í—ˆê°€ ì ˆì°¨ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ìš”ì§€ ì¤‘ì‹¬)</title>
  <style>
    :root{
      --bg:#f6f8fc;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --soft:#f1f5f9;
      --accent:#2563eb;
      --accent2:#06b6d4;
      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#dc2626;
      --shadow: 0 12px 30px rgba(15,23,42,.08);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", Arial, sans-serif;
      background: radial-gradient(1200px 600px at 10% 0%, #eef2ff 0%, transparent 55%),
                  radial-gradient(900px 500px at 90% 10%, #ecfeff 0%, transparent 50%),
                  var(--bg);
      color:var(--ink);
    }
    .topbar{max-width:1200px;margin:22px auto 0;padding:0 16px}
    .hero{
      background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(255,255,255,.86));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    .hero h1{font-size:18px;margin:0 0 6px;letter-spacing:-0.2px}
    .hero p{margin:0;color:var(--muted);font-size:13px;line-height:1.5}
    .chips{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;margin-top:2px}
    .chip{
      font-size:12px;padding:8px 10px;border-radius:999px;border:1px solid var(--line);
      background:#fff;color:var(--muted);white-space:nowrap;display:flex;align-items:center;gap:6px
    }
    .dot{width:8px;height:8px;border-radius:99px;display:inline-block}
    .dot.a{background:var(--accent2)}
    .dot.b{background:var(--accent)}
    .dot.c{background:#0ea5e9}

    .wrap{
      max-width:1200px;margin:16px auto 56px;padding:0 16px;
      display:grid;grid-template-columns: 1.22fr .78fr;gap:16px;
    }
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr;} }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHead{
      padding: 14px 16px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      display:flex;align-items:center;justify-content:space-between;gap:10px
    }
    .cardHead h2{font-size:14px;margin:0;letter-spacing:-0.1px}
    .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .content{padding:16px}

    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:740px){ .grid2{grid-template-columns:1fr} }

    .field{
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      background: linear-gradient(180deg, #ffffff, #fbfdff);
    }
    .field.blue{border-color: rgba(37,99,235,.25)}
    .field.blue:focus-within{border-color: rgba(37,99,235,.60); box-shadow: 0 0 0 5px rgba(37,99,235,.12);}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;font-weight:800}
    select, input{
      width:100%;border:1px solid var(--line);border-radius:12px;padding:10px;
      font-size:14px;background:#fff;color:var(--ink);outline:none;
    }
    select:focus, input:focus{border-color: rgba(6,182,212,.65); box-shadow: 0 0 0 4px rgba(6,182,212,.12);}

    .hint{font-size:12px;color:var(--muted);margin-top:8px;line-height:1.45}
    .notice{
      padding:12px;border-radius:14px;background:#fff7ed;border:1px solid rgba(245,158,11,.35);
      color:#7c2d12;font-size:13px;line-height:1.5;display:flex;gap:10px;align-items:flex-start
    }
    .notice .badge{
      width:22px;height:22px;border-radius:99px;display:grid;place-items:center;
      background: rgba(245,158,11,.15);border:1px solid rgba(245,158,11,.25);font-weight:900;flex:0 0 auto
    }

    .tabs{
      display:flex;gap:8px;flex-wrap:wrap;
      padding: 12px 16px;border-bottom:1px solid var(--line);background:#f8fbff;
    }
    .tab{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;
      font-size:13px;color:var(--muted);user-select:none;cursor:pointer;
    }
    .tab.active{
      border-color: rgba(37,99,235,.35);
      box-shadow: 0 0 0 4px rgba(37,99,235,.10);
      color: var(--ink);
    }
    .tabNum{
      width:22px;height:22px;border-radius:99px;display:grid;place-items:center;
      background:#e8f0ff;color:var(--accent);font-weight:900;font-size:12px;
    }

    .sectionTitle{font-size:12px;color:var(--muted);font-weight:900;margin-bottom:8px}
    .miniCard{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fff}
    .list{margin:10px 0 0;padding-left:18px;color:var(--ink);font-size:13px;line-height:1.55}
    .list li{margin:6px 0}
    .muted{color:var(--muted)}
    .divider{height:1px;background:var(--line);margin:14px 0}

    .pill{
      display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;
      font-size:12px;font-weight:900;border:1px solid var(--line);background:#fff;color:var(--muted)
    }
    .pill.good{color:#0b5d2a;border-color:rgba(22,163,74,.35);background:rgba(22,163,74,.08)}
    .pill.warn{color:#7a4b00;border-color:rgba(245,158,11,.40);background:rgba(245,158,11,.10)}
    .pill.bad{color:#7f1d1d;border-color:rgba(220,38,38,.35);background:rgba(220,38,38,.08)}
    .pill.neutral{color:#0f172a;border-color:rgba(2,132,199,.25);background:rgba(2,132,199,.07)}

    details{
      border:1px solid var(--line);border-radius:14px;background:#fff;overflow:hidden
    }
    summary{
      cursor:pointer;padding:12px 14px;font-weight:900;font-size:13px;color:var(--ink);
      list-style:none;user-select:none;background:#f8fafc;border-bottom:1px solid var(--line);
    }
    details[open] summary{border-bottom:1px solid var(--line)}
    .detailsBody{padding:12px 14px;font-size:13px;color:var(--muted);line-height:1.55}

    .rightSticky{position:sticky;top:16px;align-self:start}
    @media (max-width: 980px){ .rightSticky{position:static;} }

    .kv{
      display:flex;justify-content:space-between;gap:10px;
      padding:8px 0;border-bottom:1px dashed rgba(148,163,184,.5);font-size:13px
    }
    .kv:last-child{border-bottom:none}
    .kv b{font-weight:900}

    .copyArea{
      width:100%;height:170px;border:1px solid var(--line);border-radius:14px;
      padding:10px;font-size:12px;background:#0b1220;color:#e5e7eb;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      resize:vertical;
    }
    .copyRow{display:flex;gap:10px;align-items:center;margin-top:10px}
    button{
      border:1px solid var(--line);background:#fff;border-radius:12px;
      padding:10px 12px;font-weight:900;cursor:pointer;color:var(--ink)
    }
    button.primary{background:var(--accent);border-color:rgba(37,99,235,.4);color:#fff}
    button:disabled{opacity:.55;cursor:not-allowed}
    a.link{color:var(--accent);text-decoration:none}
    a.link:hover{text-decoration:underline}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="hero">
      <div>
        <h1>ìš©ë„ë³„ ì¸í—ˆê°€ ì ˆì°¨ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ìš”ì§€ ì¤‘ì‹¬)</h1>
        <p>
          <b>ìš©ë„</b>ë¥¼ ê³ ë¥´ë©´, <b>ì‹¬ì˜ â†’ í—ˆê°€/ì‹ ê³  â†’ ì°©ê³µ â†’ ì‚¬ìš©ìŠ¹ì¸ â†’ ê±´ì¶•ë¬¼ëŒ€ì¥</b> ìˆœì„œëŒ€ë¡œ<br/>
          í•´ë‹¹ ë‹¨ê³„ì—ì„œ í™•ì¸í•´ì•¼ í•  <b>ê²°ì • ì§ˆë¬¸ / ì²´í¬ë¦¬ìŠ¤íŠ¸ / ë²•ë ¹ ìš”ì§€</b>ê°€ í¼ì³ì§‘ë‹ˆë‹¤.
        </p>
      </div>
      <div class="chips">
        <span class="chip"><span class="dot a"></span>ë³„í‘œ1 ìš©ë„ ìˆœì„œ</span>
        <span class="chip"><span class="dot b"></span>ì ˆì°¨ 5ë‹¨ íƒ­</span>
        <span class="chip"><span class="dot c"></span>ë²•ë ¹: ìš”ì§€ ì¤‘ì‹¬</span>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- LEFT -->
    <div class="card">
      <div class="cardHead">
        <div>
          <h2>ìš©ë„ë³„ ì ˆì°¨ í¼ì¹¨</h2>
          <div class="sub">â€œëŒ€ìˆ˜ì„  íŒì •â€ì€ ë¤. ë©”ì¸ì€ â€œì ˆì°¨ ë‹¨ê³„ë³„ ë²•ë ¹/ì„œë¥˜/í¬ì¸íŠ¸â€ì…ë‹ˆë‹¤.</div>
        </div>
        <div style="display:flex; gap:10px; align-items:center">
          <span class="pill neutral" id="statusPill">ì¤€ë¹„</span>
        </div>
      </div>

      <div class="content">
        <div class="grid2">
          <div class="field blue">
            <label for="useType">ìš©ë„ ì„ íƒ (ê±´ì¶•ë²• ì‹œí–‰ë ¹ [ë³„í‘œ1] ìˆœì„œ)</label>
            <select id="useType"></select>
            <div class="hint">
              ì„ íƒí•œ ìš©ë„ì— ë”°ë¼ ë‹¨ê³„ë³„ â€œì˜ˆì™¸/ì¶”ê°€ ì²´í¬â€ê°€ ë¶™ìŠµë‹ˆë‹¤. (ê³„ì† í™•ì¥ ê°€ëŠ¥)
            </div>
          </div>
          <div class="field blue">
            <label for="scopeMode">í‘œì‹œ ëª¨ë“œ</label>
            <select id="scopeMode">
              <option value="gist">ìš”ì§€ ì¤‘ì‹¬(ì¶”ì²œ)</option>
              <option value="compact">ì´ˆê°„ë‹¨(í•µì‹¬ë§Œ)</option>
            </select>
            <div class="hint">
              â€œìš”ì§€ ì¤‘ì‹¬â€ì€ ì¡°ë¬¸ ë²ˆí˜¸ + ìš”ì§€ 1~2ì¤„, â€œì´ˆê°„ë‹¨â€ì€ ì²´í¬ í•­ëª©ë§Œ ë³´ì—¬ì¤ë‹ˆë‹¤.
            </div>
          </div>
        </div>

        <div style="margin-top:12px" class="notice">
          <div class="badge">!</div>
          <div>
            <b>ì£¼ì˜(ìš´ì˜ ì² í•™)</b><br/>
            ì´ í˜ì´ì§€ëŠ” â€œì‹¤ë¬´ì—ì„œ ë¹ ì§€ê¸° ì‰¬ìš´ í¬ì¸íŠ¸â€ë¥¼ <b>ë³´ìˆ˜ì ìœ¼ë¡œ</b> ì•ˆë‚´í•©ë‹ˆë‹¤.
            ìµœì¢… íŒë‹¨ì€ ê´€í• ì²­ í•´ì„, ì¡°ë¡€/ì§€êµ¬ë‹¨ìœ„, ë„ë©´/êµ¬ì¡°/ë°©ì¬ ê²€í† ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.
          </div>
        </div>
      </div>

      <div class="tabs" id="tabs">
        <div class="tab active" data-stage="review"><span class="tabNum">1</span>ì‹¬ì˜</div>
        <div class="tab" data-stage="permit"><span class="tabNum">2</span>í—ˆê°€/ì‹ ê³ </div>
        <div class="tab" data-stage="start"><span class="tabNum">3</span>ì°©ê³µ</div>
        <div class="tab" data-stage="approval"><span class="tabNum">4</span>ì‚¬ìš©ìŠ¹ì¸</div>
        <div class="tab" data-stage="ledger"><span class="tabNum">5</span>ê±´ì¶•ë¬¼ëŒ€ì¥</div>
      </div>

      <div class="content">
        <section id="stagePanel"></section>

        <div class="divider"></div>

        <div class="miniCard">
          <div class="sectionTitle">ë³µì‚¬ ê°€ëŠ¥í•œ ìš”ì•½(í˜„ ë‹¨ê³„)</div>
          <textarea class="copyArea" id="copyBox" readonly></textarea>
          <div class="copyRow">
            <button class="primary" id="btnCopy">ìš”ì•½ ë³µì‚¬</button>
            <span class="muted" id="copyMsg"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="rightSticky">
      <div class="card">
        <div class="cardHead">
          <div>
            <h2>í˜„ì¬ ì„ íƒ ìš”ì•½</h2>
            <div class="sub">â€œë‚´ê°€ ì§€ê¸ˆ ì–´ë”” ë³´ëŠ” ì¤‘?â€</div>
          </div>
          <span class="pill neutral" id="quickTag">ëŒ€ê¸°</span>
        </div>
        <div class="content">
          <div class="miniCard">
            <div class="sectionTitle">ê¸°ë³¸</div>
            <div class="kv"><span>ìš©ë„</span><b id="sumUse">-</b></div>
            <div class="kv"><span>ë‹¨ê³„</span><b id="sumStage">ì‹¬ì˜</b></div>
            <div class="kv"><span>ëª¨ë“œ</span><b id="sumMode">ìš”ì§€ ì¤‘ì‹¬</b></div>
          </div>

          <div style="height:12px"></div>

          <details>
            <summary>ğŸ§© í™•ì¥ ë¡œë“œë§µ(ë¼ˆëŒ€ ìœ ì§€)</summary>
            <div class="detailsBody">
              1) ë³„í‘œ1 ìš©ë„ë³„ â€œì˜ˆì™¸/ì¶”ê°€â€ ë°ì´í„° í™•ì¥<br/>
              2) ì¡°ë¡€/ì§€êµ¬ë‹¨ìœ„/ë°©í™”ì§€êµ¬ ë“± ì§€ì—­ ëª¨ë“ˆ ì¶”ê°€<br/>
              3) ê²°ê³¼ì— â€œì„œë¥˜ í…œí”Œë¦¿/ì˜ˆì‹œâ€ ì—°ê²°<br/>
              4) (ë„êµ¬) ëŒ€ìˆ˜ì„ /ìš©ë„ë³€ê²½/ì¦ì¶•Â·ê°œì¶• íŒì •ê¸° ì¶”ê°€
            </div>
          </details>

          <div style="height:12px"></div>

          <div class="muted" style="font-size:12px; line-height:1.55">
            â€» ë³¸ í˜ì´ì§€ëŠ” â€œìš”ì§€ ì¤‘ì‹¬â€ì…ë‹ˆë‹¤. ì¡°ë¬¸ ì „ë¬¸ì€ ë³„ë„ ë§í¬/ì°¸ì¡°ë¡œ í™•ì¥í•  ìˆ˜ ìˆì–´ìš”.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---------------------------------------------------------
  // 1) ë³„í‘œ1 ìš©ë„ ì˜µì…˜(ìˆœì„œ ìœ ì§€, ê°„ì´)
  // ---------------------------------------------------------
  const USE_OPTIONS = [
    { group: "1. ë‹¨ë…ì£¼íƒ", items: [
      ["single", "1. ë‹¨ë…ì£¼íƒ(ë‹¨ë…/ë‹¤ê°€êµ¬/ë‹¤ì¤‘/ê³µê´€ ë“±)"],
      ["multiHouse", "1-ë‚˜. ë‹¤ì¤‘ì£¼íƒ"],
      ["multiFamily", "1-ë‹¤. ë‹¤ê°€êµ¬ì£¼íƒ"],
      ["official", "1-ë¼. ê³µê´€(å…¬é¤¨)"]
    ]},
    { group: "2. ê³µë™ì£¼íƒ", items: [
      ["apartment", "2-ê°€. ì•„íŒŒíŠ¸"],
      ["row", "2-ë‚˜. ì—°ë¦½ì£¼íƒ"],
      ["multiUnit", "2-ë‹¤. ë‹¤ì„¸ëŒ€ì£¼íƒ"],
      ["dorm", "2-ë¼. ê¸°ìˆ™ì‚¬"]
    ]},
    { group: "3. ì œ1ì¢… ê·¼ë¦°ìƒí™œì‹œì„¤", items: [
      ["nhood1", "3. ì œ1ì¢… ê·¼ë¦°ìƒí™œì‹œì„¤"]
    ]},
    { group: "4. ì œ2ì¢… ê·¼ë¦°ìƒí™œì‹œì„¤", items: [
      ["nhood2", "4. ì œ2ì¢… ê·¼ë¦°ìƒí™œì‹œì„¤"]
    ]},
    { group: "ê¸°íƒ€(ëŒ€í‘œ)", items: [
      ["culture", "5. ë¬¸í™” ë° ì§‘íšŒì‹œì„¤"],
      ["religion", "6. ì¢…êµì‹œì„¤"],
      ["sales", "7. íŒë§¤ì‹œì„¤"],
      ["medical", "9. ì˜ë£Œì‹œì„¤"],
      ["edu", "10. êµìœ¡ì—°êµ¬ì‹œì„¤"],
      ["elder", "11. ë…¸ìœ ìì‹œì„¤"],
      ["office", "14. ì—…ë¬´ì‹œì„¤"],
      ["lodging", "15. ìˆ™ë°•ì‹œì„¤"],
      ["factory", "17. ê³µì¥"],
      ["warehouse", "18. ì°½ê³ ì‹œì„¤"],
      ["etc", "ê¸°íƒ€/ë¯¸ìƒ"]
    ]}
  ];

  // ---------------------------------------------------------
  // 2) ë‹¨ê³„ ì •ì˜(ê³ ì • 5ë‹¨)
  // ---------------------------------------------------------
  const STAGES = [
    { key:"review",  label:"ì‹¬ì˜" },
    { key:"permit",  label:"í—ˆê°€/ì‹ ê³ " },
    { key:"start",   label:"ì°©ê³µ" },
    { key:"approval",label:"ì‚¬ìš©ìŠ¹ì¸" },
    { key:"ledger",  label:"ê±´ì¶•ë¬¼ëŒ€ì¥" }
  ];

  // ---------------------------------------------------------
  // 3) ê³µí†µ(ê¸°ë³¸) ì²´í¬ë¦¬ìŠ¤íŠ¸ í…œí”Œë¦¿
  //    - ìš”ì§€ ì¤‘ì‹¬: lawRefs.gistëŠ” 1~2ì¤„ë¡œ ìœ ì§€
  // ---------------------------------------------------------
  const COMMON = {
    review: {
      decisions: [
        "ì´ í”„ë¡œì íŠ¸ê°€ â€˜ì‚¬ì „ê²€í† /ì‚¬ì „ìë¬¸/ìœ„ì›íšŒ ì‹¬ì˜â€™ ëŒ€ìƒì¸ì§€ í™•ì¸",
        "ì§€êµ¬ë‹¨ìœ„/ê²½ê´€/êµí†µ/ì¬í•´/ë°©ì¬ ë“± â€˜ì„ í–‰ ì‹¬ì˜ íŠ¸ë¦¬ê±°â€™ê°€ ìˆëŠ”ì§€ í™•ì¸",
        "ëŒ€ì§€ ì¡°ê±´(ë„ë¡œ/ì ‘ë„/ê³ ì €ì°¨/ëŒ€ì§€ì•ˆì˜ ê³µì§€)ì´ ê³„íšì— ì˜í–¥ì„ ì£¼ëŠ”ì§€ í™•ì¸"
      ],
      checklist: [
        "ê±´ì¶•ê°œìš”(ìš©ë„/ê·œëª¨/ì¸µìˆ˜/ì—°ë©´ì /ì£¼ì°¨/êµ¬ì¡°) ì •ë¦¬",
        "ë°°ì¹˜/í‰ë©´/ë‹¨ë©´/ì…ë©´ â€˜ê¸°ë³¸ë„â€™ ì¤€ë¹„",
        "ëŒ€ì§€/ë„ë¡œ/ì¸ì ‘ëŒ€ì§€ í˜„í™©(ë„ì‹œê³„íš/ì§€êµ¬ë‹¨ìœ„/ê²½ê´€ì§€êµ¬ ë“±) í™•ì¸",
        "ì‹¬ì˜ ìš”êµ¬ìë£Œ(ì¡°ê°ë„/ì¼ì¡°/ì£¼ì°¨/í”¼ë‚œ/ë™ì„ /ì¥ì• ë¬¼ì—†ëŠ” ìƒí™œí™˜ê²½ ë“±) ì²´í¬"
      ],
      lawRefs: [
        { law:"ê±´ì¶•ë²•", article:"(ì‹¬ì˜ ê´€ë ¨ ì¡°ë¬¸ì€ ì§€ìì²´/ìœ„ì›íšŒ ìš´ì˜ê¸°ì¤€ê³¼ í•¨ê»˜ í™•ì¸)", gist:"ì‹¬ì˜ëŠ” â€˜ìš©ë„/ê·œëª¨/ì…ì§€â€™ì— ì˜í•´ ì„ í–‰ ê²€í† ê°€ ìš”êµ¬ë  ìˆ˜ ìˆìŒ. ê´€í•  ê¸°ì¤€(ì¡°ë¡€/ì§€ì¹¨)ê³¼ í•¨ê»˜ í™•ì¸." }
      ]
    },

    permit: {
      decisions: [
        "í—ˆê°€ì¸ì§€ ì‹ ê³ ì¸ì§€(ëŒ€ìˆ˜ì„ /ì¦ì¶•/ê°œì¶•/ìš©ë„ë³€ê²½ ë“±) í–‰ìœ„ ìœ í˜• í™•ì •",
        "ëŒ€ìˆ˜ì„ ì´ë¼ë©´: ì‹ ê³  ê°€ëŠ¥ ë²”ìœ„ì¸ì§€(í•´ì²´ ì—¬ë¶€/ìˆ˜ì„  ì¤‘ì‹¬/í•­ëª© ë²”ìœ„) í™•ì¸",
        "ìš©ë„ë³„ ì¶”ê°€ ê¸°ì¤€(í”¼ë‚œ/ë°©í™”/ì£¼ì°¨/ìœ„ìƒ/í™˜ê¸°/BF ë“±) ì ìš© ì—¬ë¶€ í™•ì¸"
      ],
      checklist: [
        "í–‰ìœ„ìœ í˜• ì •ë¦¬(ëŒ€ìˆ˜ì„ /ì¦ì¶•/ê°œì¶•/ìš©ë„ë³€ê²½/ëŒ€ìˆ˜ì„ +ìš©ë„ë³€ê²½ ë“±)",
        "ì£¼ìš”êµ¬ì¡°ë¶€ ì˜í–¥(ë‚´ë ¥ë²½/ê¸°ë‘¥/ë³´/ì§€ë¶•í‹€) ìœ ë¬´ í™•ì¸",
        "ê´€í•  ì ‘ìˆ˜ ì„œë¥˜(ì‹ ì²­ì„œ/ë„ë©´/êµ¬ì¡°/ì„¤ë¹„/ë°©ì¬/ì—ë„ˆì§€ ë“±) ëª©ë¡í™”",
        "ê´€í•  ì‚¬ì „í˜‘ì˜(ì†Œë°©/ì „ê¸°/ê°€ìŠ¤/í•˜ìˆ˜/ë„ë¡œ ë“±) í•„ìš” ì—¬ë¶€ í™•ì¸"
      ],
      lawRefs: [
        { law:"ê±´ì¶•ë²•", article:"(í—ˆê°€/ì‹ ê³  ì²´ê³„ ì¡°ë¬¸)", gist:"ê±´ì¶•í–‰ìœ„ëŠ” ì›ì¹™ì ìœ¼ë¡œ í—ˆê°€ ëŒ€ìƒì´ë©°, ì¼ë¶€ëŠ” ìš”ê±´ì„ ê°–ì¶”ë©´ ì‹ ê³ ë¡œ ì²˜ë¦¬. í–‰ìœ„ ìœ í˜•ì„ ë¨¼ì € í™•ì •í•´ì•¼ í•¨." },
        { law:"ê±´ì¶•ë²• ì‹œí–‰ë ¹", article:"ì œ11ì¡°(ëŒ€ìˆ˜ì„ ì˜ ì‹ ê³  ë“±)", gist:"ëŒ€ìˆ˜ì„  ì¤‘ ì¼ì • ìš”ê±´ì„ ê°–ì¶”ë©´ â€˜ì‹ ê³ â€™ë¡œ ê°€ëŠ¥. í•´ì²´ ì—¬ë¶€/ê³µì‚¬ ì„±ê²©/í•­ëª© ë²”ìœ„ê°€ í•µì‹¬ ë¶„ê¸°." }
      ]
    },

    start: {
      decisions: [
        "ì°©ê³µì‹ ê³  ëŒ€ìƒì¸ì§€, ì°©ê³µ ì „ í™•ì¸/í˜‘ì˜/ê²€ì‚¬ íŠ¸ë¦¬ê±°ê°€ ìˆëŠ”ì§€ í™•ì¸",
        "ê°ë¦¬/ì‹œê³µì/êµ¬ì¡° ì•ˆì „ ê´€ë ¨ ì˜ë¬´ê°€ ë¶™ëŠ”ì§€ í™•ì¸",
        "ê³µì‚¬ ì¤‘ ë³€ê²½(ê²½ë¯¸/ì¤‘ëŒ€) ë°œìƒ ì‹œ ì²˜ë¦¬ í”Œë¡œìš° í™•ì •"
      ],
      checklist: [
        "ì°©ê³µì‹ ê³  ì„œë¥˜(ê°ë¦¬/ì‹œê³µ/ì•ˆì „/ê³µì • ë“±) ì¤€ë¹„",
        "í˜„ì¥ ê´€ë¦¬ì²´ê³„(í’ˆì§ˆ/ì•ˆì „/ì‚¬ì§„/ë³€ê²½ê´€ë¦¬) ì„¸íŒ…",
        "ê³µì‚¬ ì¤‘ ë³€ê²½ ë°œìƒ ì‹œ: ë³€ê²½í—ˆê°€/ë³€ê²½ì‹ ê³  ê¸°ì¤€ í™•ì¸"
      ],
      lawRefs: [
        { law:"ê±´ì¶•ë²•", article:"(ì°©ê³µì‹ ê³ /ê°ë¦¬ ê´€ë ¨ ì¡°ë¬¸)", gist:"í—ˆê°€(ë˜ëŠ” ì‹ ê³ ) ì´í›„ ì°©ê³µ ë‹¨ê³„ì—ì„œ ê°ë¦¬/ì‹œê³µ/ì•ˆì „ ì˜ë¬´ê°€ ê²°í•©. ê³µì‚¬ì¤‘ ë³€ê²½ê´€ë¦¬ ì²´ê³„ë¥¼ ë¯¸ë¦¬ ì¡ëŠ” ê²Œ ë¦¬ìŠ¤í¬ë¥¼ ì¤„ì„." }
      ]
    },

    approval: {
      decisions: [
        "ì‚¬ìš©ìŠ¹ì¸ ì‹ ì²­ ì‹œì ê³¼ ì‚¬ì „ì ê²€(ì†Œë°©/í”¼ë‚œ/ì„¤ë¹„) í•­ëª© í™•ì¸",
        "ì¤€ê³µë„ë©´/ë³€ê²½ë‚´ì—­ì´ ìµœì¢… ì„œë¥˜ì— ë°˜ì˜ëëŠ”ì§€ í™•ì¸",
        "ê²€ì‚¬ ì§€ì ì‚¬í•­ ë°œìƒ ì‹œ ë³´ì™„ ë£¨í”„(ì¬ê²€ì‚¬/ì„œë¥˜ë³´ì™„) ì¤€ë¹„"
      ],
      checklist: [
        "ì‚¬ìš©ìŠ¹ì¸ ì‹ ì²­ì„œ/ì¤€ê³µë„ë©´/ê²€ì‚¬ì„œë¥˜ ì¤€ë¹„",
        "í˜„ì¥ ì¤€ê³µ ìƒíƒœì™€ í—ˆê°€ë„ì„œ ì¼ì¹˜ ì—¬ë¶€ ì ê²€(ë³€ê²½ë¶„ í¬í•¨)",
        "ì„¤ë¹„/í”¼ë‚œ/ë°©ì¬/ì¥ì• ì¸ í¸ì˜ ë“± í™•ì¸ì„œë¥˜ ì·¨í•©"
      ],
      lawRefs: [
        { law:"ê±´ì¶•ë²•", article:"(ì‚¬ìš©ìŠ¹ì¸ ê´€ë ¨ ì¡°ë¬¸)", gist:"ì‚¬ìš©ìŠ¹ì¸ì€ â€˜í—ˆê°€/ì‹ ê³  ë‚´ìš©ëŒ€ë¡œ ì‹œê³µë˜ì—ˆëŠ”ì§€â€™ í™•ì¸í•˜ëŠ” ì ˆì°¨. ì¤€ê³µë„ë©´ê³¼ ë³€ê²½ì´ë ¥ ì •ë¦¬ê°€ í•µì‹¬." }
      ]
    },

    ledger: {
      decisions: [
        "ê±´ì¶•ë¬¼ëŒ€ì¥(í‘œì œë¶€/ì „ìœ ë¶€ ë“±) ê¸°ì¬ í•­ëª©ì´ ìµœì¢… ìƒíƒœì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸",
        "ìš©ë„/ë©´ì /ì¸µìˆ˜/êµ¬ì¡°/ìŠ¹ê°•ê¸° ë“± ì£¼ìš” í•­ëª© ì˜¤ë¥˜ ì—¬ë¶€ í™•ì¸",
        "í–¥í›„ ë§¤ë§¤/ëŒ€ì¶œ/ì„ëŒ€/ë¦¬ëª¨ë¸ë§ì— ì˜í–¥ ì£¼ëŠ” í•­ëª© ì„ ì ê²€"
      ],
      checklist: [
        "ê±´ì¶•ë¬¼ëŒ€ì¥ ê¸°ì¬ì‚¬í•­ ì—´ëŒ/ì •ë¦¬",
        "ì˜¤ë¥˜ê°€ ìˆìœ¼ë©´ ì •ì • ì ˆì°¨(ê·¼ê±°ì„œë¥˜/ë„ë©´) ì¤€ë¹„",
        "ëŒ€ì¥-í˜„í™© ë¶ˆì¼ì¹˜(ìœ„ë°˜ê±´ì¶•ë¬¼ ë“±) ë¦¬ìŠ¤í¬ ì²´í¬"
      ],
      lawRefs: [
        { law:"ê±´ì¶•ë²•", article:"(ê±´ì¶•ë¬¼ëŒ€ì¥ ê´€ë ¨ ì¡°ë¬¸)", gist:"ê±´ì¶•ë¬¼ëŒ€ì¥ì€ â€˜ë²•ì  í˜„í™©â€™ì˜ í•µì‹¬ ë¬¸ì„œ. ì˜¤ë¥˜/ë¶ˆì¼ì¹˜ëŠ” ê±°ë˜/ëŒ€ì¶œ/í–‰ì •ì²˜ë¶„ ë¦¬ìŠ¤í¬ë¡œ ì§ê²°." }
      ]
    }
  };

  // ---------------------------------------------------------
  // 4) ìš©ë„ë³„ â€˜ì¶”ê°€/ì˜ˆì™¸â€™ ë§ë¶™ì„ (ìƒ˜í”Œ)
  //    - ì—¬ê¸°ë§Œ ê³„ì† í™•ì¥í•˜ë©´ â€œë³„í‘œ1 ìš©ë„ë³„â€ë¡œ ê°•í•´ì§
  // ---------------------------------------------------------
  const USE_OVERRIDES = {
    multiUnit: {
      review: {
        decisions: [
          "ê³µë™ì£¼íƒ íŠ¹ì„±ìƒ: ì£¼ì°¨/í”¼ë‚œ/ì±„ê´‘/ì¼ì¡°/ê²½ê´€ ë“± ì‹¬ì˜ íŠ¸ë¦¬ê±° ì‚¬ì „ ì²´í¬",
        ],
        checklist: [
          "ì„¸ëŒ€ êµ¬ì„±/ê³µìš©ë¶€ ê³„íš(ê³„ë‹¨/ë³µë„/í”¼ë‚œ) ëª…í™•í™”",
          "ì£¼ì°¨ ì‚°ì •/ë°°ì¹˜ê°€ ì´ˆê¸° ì„¤ê³„ë¥¼ â€˜ì—­ìœ¼ë¡œâ€™ ì§€ë°°í•˜ëŠ”ì§€ í™•ì¸"
        ],
        lawRefs: [
          { law:"ê±´ì¶•ë²• ì‹œí–‰ë ¹", article:"ë³„í‘œ1(ê³µë™ì£¼íƒ)", gist:"ê³µë™ì£¼íƒì€ ê·œëª¨Â·ì¸µìˆ˜Â·ì„¸ëŒ€ ê³„íšì— ë”°ë¼ ì¶”ê°€ ê¸°ì¤€ì´ ìì£¼ ë¶™ìŒ. ì´ˆê¸° ë‹¨ê³„ì—ì„œ â€˜ì£¼ì°¨/í”¼ë‚œâ€™ì´ í•µì‹¬." }
        ]
      },
      permit: {
        decisions: [
          "ëŒ€ìˆ˜ì„ /ìš©ë„ë³€ê²½ì´ ìˆìœ¼ë©´: ì„¸ëŒ€/ê³µìš©ë¶€/í”¼ë‚œ ê³„íšì´ í•¨ê»˜ ë³€í•˜ëŠ”ì§€ í™•ì¸",
          "ë‚´ë ¥ë²½ ë³€ê²½ ë“± êµ¬ì¡° ì˜í–¥ì´ ìˆìœ¼ë©´: í—ˆê°€ ìª½ìœ¼ë¡œ ë³´ìˆ˜ì  ì ‘ê·¼"
        ],
        checklist: [
          "ì„¸ëŒ€ìˆ˜/ë©´ì  ë³€ê²½ ì—¬ë¶€(ëŒ€ì¥/ë¶„ì–‘/ì„ëŒ€ ì˜í–¥) ì²´í¬",
          "í”¼ë‚œ/ë°©í™” êµ¬íš ë³€í™” ì²´í¬(ê³„ë‹¨/ë³µë„/ë°©í™”ë¬¸ ë“±)"
        ],
        lawRefs: [
          { law:"ê±´ì¶•ë²• ì‹œí–‰ë ¹", article:"ì œ11ì¡°(ëŒ€ìˆ˜ì„  ì‹ ê³ )", gist:"ê³µë™ì£¼íƒì€ ê³µìš©ë¶€Â·í”¼ë‚œ ì˜í–¥ì´ í¬ë¯€ë¡œ â€˜í•´ì²´ ì—†ìŒ/ìˆ˜ì„  ì¤‘ì‹¬â€™ì´ ì•„ë‹ˆë©´ í—ˆê°€ ê²€í† ê°€ ì•ˆì „." }
        ]
      }
    },

    nhood1: {
      permit: {
        decisions: [
          "ì œ1ì¢… ê·¼ìƒì€ â€˜ì„¸ë¶€ ì—…ì¢…â€™ì— ë”°ë¼ ë©´ì /ì„¤ë¹„/ìœ„ìƒ/ë°°ì¶œ ê·œì œê°€ ê°ˆë¦¼",
          "ê°™ì€ ê±´ì¶•ë¬¼ ë‚´ ë©´ì  í•©ì‚° ê·œì •(ë¹„ê³ )ìœ¼ë¡œ 1ì¢…/2ì¢… ê²½ê³„ ë„˜ëŠ”ì§€ í™•ì¸"
        ],
        lawRefs: [
          { law:"ê±´ì¶•ë²• ì‹œí–‰ë ¹", article:"ë³„í‘œ1 ë¹„ê³ (ë©´ì  ì‚°ì •/í•©ì‚°)", gist:"ê·¼ìƒì€ â€˜í•´ë‹¹ ìš©ë„ë¡œ ì“°ëŠ” ë°”ë‹¥ë©´ì â€™ ì‚°ì • ë° ë™ì¼ì¸/ì—°ê³„ ì‚¬ìš© ì‹œ í•©ì‚° ê·œì •ì´ í•µì‹¬ í•¨ì •." }
        ]
      }
    },

    nhood2: {
      permit: {
        decisions: [
          "ì œ2ì¢… ê·¼ìƒì€ ì—…ì¢…ë³„ë¡œ â€˜ì œí•œ/íŠ¹ë¡€/ë‹¤ë¥¸ ë²•ë ¹â€™ ê²°í•©ì´ ë§ìŒ",
          "ë©´ì  ê¸°ì¤€(500ã¡ ë“±) ë„˜ì–´ê°€ë©´ ë‹¤ë¥¸ ìš©ë„ë¡œ ë¶„ë¥˜ë  ìˆ˜ ìˆìŒ"
        ],
        lawRefs: [
          { law:"ê±´ì¶•ë²• ì‹œí–‰ë ¹", article:"ë³„í‘œ1(ì œ2ì¢… ê·¼ìƒ)", gist:"ë©´ì  ê¸°ì¤€ì„ ë„˜ê±°ë‚˜ ì—…ì¢…ì´ íŠ¹ì • ë²•ë ¹ê³¼ ê²°í•©ë˜ë©´ ë¶„ë¥˜/ìš”ê±´ì´ ë°”ë€œ. â€˜ì—…ì¢…+ë©´ì +í•©ì‚°â€™ 3ì¢… ì„¸íŠ¸ë¡œ ì ê²€." }
        ]
      }
    }
  };

  // ---------------------------------------------------------
  // 5) (ë¤) ëŒ€ìˆ˜ì„  íŒì •ê¸° ë§í¬/ì„ë² ë“œ ì˜µì…˜
  //    - ê°™ì€ ì‚¬ì´íŠ¸ ë‚´ì— /major-repair.html ê°™ì€ ë³„ë„ í˜ì´ì§€ë¡œ ë¶„ë¦¬ ì¶”ì²œ
  // ---------------------------------------------------------
  const TOOL_LINK = {
    label: "ëŒ€ìˆ˜ì„  íŒì •ê¸°(MVP) ì—´ê¸°",
    href: "#", // ì›í•˜ë©´: "major-repair.html" ë¡œ ë°”ê¾¸ê¸°
    note: "í˜„ì¬ í˜ì´ì§€ëŠ” ì ˆì°¨ ì²´í¬ë¦¬ìŠ¤íŠ¸ê°€ ë©”ì¸ì´ê³ , ëŒ€ìˆ˜ì„ ì€ í—ˆê°€/ì‹ ê³  ë‹¨ê³„ì—ì„œë§Œ ì°¸ê³  ë„êµ¬ë¡œ ë‘¡ë‹ˆë‹¤."
  };

  // ---------------------------------------------------------
  // 6) UI ì—˜ë¦¬ë¨¼íŠ¸
  // ---------------------------------------------------------
  let currentStage = "review";

  const els = {
    useType: document.getElementById("useType"),
    scopeMode: document.getElementById("scopeMode"),
    tabs: Array.from(document.querySelectorAll(".tab")),
    stagePanel: document.getElementById("stagePanel"),
    statusPill: document.getElementById("statusPill"),
    quickTag: document.getElementById("quickTag"),

    sumUse: document.getElementById("sumUse"),
    sumStage: document.getElementById("sumStage"),
    sumMode: document.getElementById("sumMode"),

    copyBox: document.getElementById("copyBox"),
    btnCopy: document.getElementById("btnCopy"),
    copyMsg: document.getElementById("copyMsg")
  };

  function buildUseOptions(){
    els.useType.innerHTML = "";
    USE_OPTIONS.forEach(g=>{
      const og = document.createElement("optgroup");
      og.label = g.group;
      g.items.forEach(([val,label])=>{
        const o = document.createElement("option");
        o.value = val; o.textContent = label;
        og.appendChild(o);
      });
      els.useType.appendChild(og);
    });
    els.useType.value = "multiUnit";
  }

  function mergeStageData(useKey, stageKey){
    const base = JSON.parse(JSON.stringify(COMMON[stageKey] || {}));
    const ov = (USE_OVERRIDES[useKey] && USE_OVERRIDES[useKey][stageKey]) ? USE_OVERRIDES[useKey][stageKey] : null;

    if(!ov) return base;

    // decisions/checklist/lawRefsëŠ” "ì¶”ê°€" ë°©ì‹
    base.decisions = [...(base.decisions||[]), ...(ov.decisions||[])];
    base.checklist = [...(base.checklist||[]), ...(ov.checklist||[])];
    base.lawRefs = [...(base.lawRefs||[]), ...(ov.lawRefs||[])];
    return base;
  }

  function setPills(){
    els.statusPill.className = "pill neutral";
    els.statusPill.textContent = "ì§„í–‰ ì¤‘";
    els.quickTag.className = "pill neutral";
    els.quickTag.textContent = "ì²´í¬ë¦¬ìŠ¤íŠ¸";
  }

  function renderStage(){
    const useKey = els.useType.value;
    const useLabel = els.useType.options[els.useType.selectedIndex]?.textContent || "-";
    const mode = els.scopeMode.value; // gist | compact

    const stageObj = STAGES.find(s=>s.key===currentStage);
    const stageLabel = stageObj ? stageObj.label : "-";

    const data = mergeStageData(useKey, currentStage);

    // right summary
    els.sumUse.textContent = useLabel;
    els.sumStage.textContent = stageLabel;
    els.sumMode.textContent = (mode==="gist") ? "ìš”ì§€ ì¤‘ì‹¬" : "ì´ˆê°„ë‹¨";

    // panel build
    const wrap = document.createElement("div");

    // header row
    const header = document.createElement("div");
    header.className = "miniCard";
    header.innerHTML = `
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <div>
          <div class="sectionTitle">í˜„ì¬ ë‹¨ê³„</div>
          <div style="font-size:15px; font-weight:900; letter-spacing:-0.1px;">${stageLabel}</div>
          <div class="muted" style="margin-top:4px; font-size:13px; line-height:1.5;">
            ìš©ë„: <b>${useLabel}</b> Â· í‘œì‹œ: <b>${mode==="gist" ? "ìš”ì§€ ì¤‘ì‹¬" : "ì´ˆê°„ë‹¨"}</b>
          </div>
        </div>
        ${currentStage==="permit" ? `
          <div style="text-align:right">
            <a class="link" href="${TOOL_LINK.href}" id="toolLink">${TOOL_LINK.label}</a>
            <div class="muted" style="font-size:12px; margin-top:6px; line-height:1.4;">${TOOL_LINK.note}</div>
          </div>
        ` : `<div class="muted" style="font-size:12px; text-align:right; line-height:1.4;">ë‹¨ê³„ë³„ í•µì‹¬ë§Œ ì­‰ í¼ì³ë³´ê¸°</div>`}
      </div>
    `;
    wrap.appendChild(header);

    // decisions
    const dCard = document.createElement("div");
    dCard.className = "miniCard";
    dCard.style.marginTop = "12px";
    dCard.innerHTML = `<div class="sectionTitle">ì´ ë‹¨ê³„ì—ì„œ ê²°ì •í•´ì•¼ í•˜ëŠ” ê²ƒ(íŒë‹¨ ì§ˆë¬¸)</div>`;
    if((data.decisions||[]).length){
      const ul = document.createElement("ul"); ul.className = "list";
      data.decisions.forEach(x=>{ const li=document.createElement("li"); li.textContent = x; ul.appendChild(li); });
      dCard.appendChild(ul);
    } else {
      dCard.innerHTML += `<div class="muted">ì¤€ë¹„ì¤‘(ì´ ìš©ë„ì˜ ì„¸ë¶€ ì˜ˆì™¸ë¥¼ ê³„ì† ì¶”ê°€í•˜ë©´ ê°•í•´ì§‘ë‹ˆë‹¤).</div>`;
    }
    wrap.appendChild(dCard);

    // checklist
    const cCard = document.createElement("div");
    cCard.className = "miniCard";
    cCard.style.marginTop = "12px";
    cCard.innerHTML = `<div class="sectionTitle">ì²´í¬ë¦¬ìŠ¤íŠ¸(ì„œë¥˜/ë„ë©´/ê²€í† )</div>`;
    if((data.checklist||[]).length){
      const ul = document.createElement("ul"); ul.className = "list";
      data.checklist.forEach(x=>{ const li=document.createElement("li"); li.textContent = x; ul.appendChild(li); });
      cCard.appendChild(ul);
    } else {
      cCard.innerHTML += `<div class="muted">ì¤€ë¹„ì¤‘</div>`;
    }
    wrap.appendChild(cCard);

    // law refs (gist)
    const lCard = document.createElement("div");
    lCard.className = "miniCard";
    lCard.style.marginTop = "12px";
    lCard.innerHTML = `<div class="sectionTitle">ë²•ë ¹ ê·¼ê±°(ìš”ì§€)</div>`;

    if(mode === "compact"){
      lCard.innerHTML += `<div class="muted">ì´ˆê°„ë‹¨ ëª¨ë“œì—ì„œëŠ” ë²•ë ¹ ìš”ì§€ëŠ” ìˆ¨ê¹ë‹ˆë‹¤. (ìš”ì§€ ì¤‘ì‹¬ìœ¼ë¡œ ì „í™˜í•˜ë©´ í‘œì‹œ)</div>`;
    } else {
      if((data.lawRefs||[]).length){
        const ul = document.createElement("ul"); ul.className = "list";
        data.lawRefs.forEach(r=>{
          const li = document.createElement("li");
          const art = r.article ? ` <span class="muted">Â· ${r.article}</span>` : "";
          li.innerHTML = `<b>${r.law}</b>${art}<div class="muted" style="margin-top:4px; font-size:12px; line-height:1.5;">${r.gist || ""}</div>`;
          ul.appendChild(li);
        });
        lCard.appendChild(ul);
      } else {
        lCard.innerHTML += `<div class="muted">ì¤€ë¹„ì¤‘</div>`;
      }
    }
    wrap.appendChild(lCard);

    // optional tips
    const tip = document.createElement("details");
    tip.style.marginTop = "12px";
    tip.innerHTML = `
      <summary>ğŸ§  ëš±ëšœë£¨ ë©”ëª¨(ìš´ì˜ íŒ)</summary>
      <div class="detailsBody">
        - â€œìš”ì§€â€ëŠ” 1~2ì¤„ë¡œ ìœ ì§€í•˜ë©´ ê²€ìƒ‰ì„±ê³¼ ê°€ë…ì„±ì´ ì¢‹ì•„ì ¸ìš”.<br/>
        - ìš©ë„ë³„ ê°•ë ¥í•´ì§€ëŠ” í¬ì¸íŠ¸ëŠ” <b>ì˜ˆì™¸/ì¶”ê°€ ê·œì •</b>ì„ ì´ ë‹¨ê³„ë³„ë¡œ ê³„ì† ìŒ“ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.<br/>
        - ë‚˜ì¤‘ì— ì§€ì—­(ì„œìš¸/ê²½ê¸°/êµ¬ë³„) í† ê¸€ì„ ë¶™ì´ë©´ ì¡°ë¡€/ì§€êµ¬ë‹¨ìœ„ ëª¨ë“ˆë„ ì‰½ê²Œ ì–¹ì„ ìˆ˜ ìˆì–´ìš”.
      </div>
    `;
    wrap.appendChild(tip);

    // render
    els.stagePanel.innerHTML = "";
    els.stagePanel.appendChild(wrap);

    // copy summary
    buildCopy(useLabel, stageLabel, mode, data);

    setPills();
  }

  function buildCopy(useLabel, stageLabel, mode, data){
    const lines = [];
    lines.push("[ìš©ë„ë³„ ì¸í—ˆê°€ ì ˆì°¨ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìš”ì•½]");
    lines.push(`- ìš©ë„: ${useLabel}`);
    lines.push(`- ë‹¨ê³„: ${stageLabel}`);
    lines.push(`- í‘œì‹œ ëª¨ë“œ: ${mode==="gist" ? "ìš”ì§€ ì¤‘ì‹¬" : "ì´ˆê°„ë‹¨"}`);
    lines.push("");

    lines.push("[ê²°ì • ì§ˆë¬¸]");
    (data.decisions||[]).slice(0, 12).forEach(x=> lines.push(`- ${x}`));
    if((data.decisions||[]).length > 12) lines.push("- (ì´í•˜ ìƒëµ)");

    lines.push("");
    lines.push("[ì²´í¬ë¦¬ìŠ¤íŠ¸]");
    (data.checklist||[]).slice(0, 12).forEach(x=> lines.push(`- ${x}`));
    if((data.checklist||[]).length > 12) lines.push("- (ì´í•˜ ìƒëµ)");

    if(mode === "gist"){
      lines.push("");
      lines.push("[ë²•ë ¹ ìš”ì§€]");
      (data.lawRefs||[]).slice(0, 8).forEach(r=>{
        const a = r.article ? ` / ${r.article}` : "";
        lines.push(`- ${r.law}${a}: ${r.gist || ""}`);
      });
      if((data.lawRefs||[]).length > 8) lines.push("- (ì´í•˜ ìƒëµ)");
    }

    lines.push("");
    lines.push("[ì£¼ì˜]");
    lines.push("- ìš”ì§€ ì¤‘ì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ìµœì¢… íŒë‹¨ì€ ê´€í• ì²­/ì¡°ë¡€/ì‚¬ë¡€/ë„ë©´/êµ¬ì¡°Â·ë°©ì¬ ê²€í† ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");

    els.copyBox.value = lines.join("\n");
  }

  function setActiveTab(stageKey){
    currentStage = stageKey;
    els.tabs.forEach(t=>{
      t.classList.toggle("active", t.dataset.stage === stageKey);
    });
    renderStage();
  }

  // copy button
  els.btnCopy.addEventListener("click", async ()=>{
    try{
      await navigator.clipboard.writeText(els.copyBox.value);
      els.copyMsg.textContent = "ë³µì‚¬ ì™„ë£Œ!";
      setTimeout(()=> els.copyMsg.textContent = "", 1500);
    }catch(e){
      els.copyMsg.textContent = "ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸)";
      setTimeout(()=> els.copyMsg.textContent = "", 2000);
    }
  });

  // events
  els.tabs.forEach(t=> t.addEventListener("click", ()=> setActiveTab(t.dataset.stage)));
  els.useType.addEventListener("change", renderStage);
  els.scopeMode.addEventListener("change", renderStage);

  // init
  buildUseOptions();
  setActiveTab("review");
</script>
</body>
</html>
